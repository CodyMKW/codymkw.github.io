<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Game Status</title>

    <!-- Favicon -->
    <link rel="icon" type="image/png" href="" id="favicon">
    <meta name="keywords" content="current,game,status,playing,Nintendo">
    <meta name="description" content="See what I'm currently playing at the moment!">
    <meta name="author" content="CodyMKW">
    <link rel="canonical" href="https://codymkw.github.io/status/">
    <meta property="og:title" content="Game Status">
    <meta property="og:description" content="See what I'm currently playing at the moment!">
    <meta property="og:image" content="https://nxapi-presence.fancy.org.uk/api/presence/resources/baas/1/3be92e8430027be9.jpeg">
    <meta property="og:url" content="https://codymkw.github.io/status/">
    <meta property="og:type" content="website">
    <meta name="twitter:creator" content="@CodyMKW" />
    <meta name="twitter:title" content="Game Status" />
    <meta name="twitter:description" content="See what I'm currently playing at the moment!" />
    <meta name="twitter:image:src" content="https://nxapi-presence.fancy.org.uk/api/presence/resources/baas/1/3be92e8430027be9.jpeg" />

    <style>
        body {
            font-family: 'Arial', sans-serif;
            background-color: #2c2c2c;
            color: #fff;
            text-align: center;
            margin: 20px;
        }

        h1 {
            color: #00C900;
        }

        #gameInfo {
            background-color: #363636;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 0 10px rgba(255, 255, 255, 0.1);
            max-width: 400px;
            margin: 0 auto 15px; /* Added margin-bottom to create space */
        }
        
        #onlineStatusContainer {
            background-color: #363636;
            border-radius: 10px;
            padding: 5px;
            box-shadow: 0 0 10px rgba(255, 255, 255, 0.1);
            max-width: 400px;
            margin: 15px auto 0; /* Added margin-top to create space */
        }

        img#gameImage {
            max-width: 70%; /* Adjust the size as needed */
            border-radius: 5px;
            margin-top: 10px;
        }
        
        img#avatarImage {
            width: 150px;
            height: 150px;
            border-radius: 5px;
            margin-top: 10px;
        }

        a {
            color: #00C900;
            text-decoration: none;
        }

        a:hover {
           color: #008a00;
        }

        /* Add styles for online status */
        span#onlineStatus {
            font-weight: bold;
        }

        .online {
            color: #4caf50; /* Green color for "Online" */
        }

        .offline {
            color: #ff4436; /* Red color for "Offline" */
        }
        .inactive {
            color: yellow; /* Yellow color for "Inactive" */
        }
    </style>
</head>
<body>
    <h1><img id="avatarImage" alt="Avatar Image"></h1>
    <h1><span id="playerName"></span> is currently playing:</h1>
    <div id="gameInfo">
        <p><span id="gameName"></span></p>
        <p><small><span id="sysDescription"></span></small></p>
        <p><img id="gameImage" alt="Game Image"></p>
        <p><strong>Title ID:</strong> <span id="gameID"></span></p>
        <!-- Display Splatoon 3 info only when playing Splatoon 3 -->
        <div id="splatoonInfo" style="display: none;">
            <p><strong>Mode:</strong> <span id="splatoonMode"></span></p>
            <p><strong>Stages:</strong> <span id="splatoonStages"></span></p>
        </div>
        <p><strong>Time Playing Now:</strong> <span id="timePlayingNow"></span></p>
        <p><strong>Total Play Time:</strong> <span id="totalPlayTime"></span></p>
        <p><strong>Time First Played:</strong> <span id="firstPlayedTime"></span></p>
        <p><strong>Get the game:</strong> <a id="gameShopLink" href="#" target="_blank">Visit eShop Page</a></p>
    </div>
    <div id="onlineStatusContainer">
        <p><strong>Online Status:</strong> <span id="onlineStatus"></span></p>
    </div>
    <script>
async function fetchData() {
    try {
        const response = await fetch('https://nxapi-presence.fancy.org.uk/api/presence/644cd5195d154bd5?include-splatoon3=1');
        const data = await response.json();

        // Update HTML with fetched data
        document.getElementById('avatarImage').src = data.friend.imageUri;
        document.getElementById('playerName').textContent = data.friend.name;

        const onlineStatusElement = document.getElementById('onlineStatus');
        const onlineStatusText = data.friend.presence.state.toLowerCase();
        const playerNameElement = document.getElementById('playerName');
        const playingStatusElement = document.querySelector('h1 span#playerName');

// Set class for styling based on online status
if (onlineStatusText === 'offline') {
    onlineStatusElement.textContent = 'Offline';
    onlineStatusElement.className = 'offline';
    playingStatusElement.textContent = `${data.friend.name} is currently offline.`;
} else if (onlineStatusText === 'inactive') {
    onlineStatusElement.textContent = 'Inactive';
    onlineStatusElement.className = 'inactive';
    playingStatusElement.textContent = `${data.friend.name} is chilling on the home menu.`;
} else {
    onlineStatusElement.textContent = onlineStatusText.charAt(0).toUpperCase() + onlineStatusText.slice(1);
    onlineStatusElement.className = data.friend.presence.state === 'ONLINE' ? 'online' : 'offline';
    playingStatusElement.textContent = `${data.friend.name} is currently playing:`;
}
        // Update favicon
        document.getElementById('favicon').href = data.friend.imageUri;
// Update additional data when title is not null
if (data.title !== null) {
    document.getElementById('gameInfo').style.display = 'block'; // Show gameInfo div
    document.getElementById('gameName').textContent = data.title.name;
    document.getElementById('sysDescription').textContent = data.friend.presence.game.sysDescription;
    document.getElementById('gameImage').src = data.title.image_url;
    document.getElementById('gameID').textContent = data.title.id;
    const firstPlayedDate = new Date(data.friend.presence.game.firstPlayedAt * 1000);
    document.getElementById('firstPlayedTime').textContent = firstPlayedDate.toLocaleString();
    document.getElementById('gameShopLink').href = data.title.url;

       // Display total play time
        const totalPlayTimeHours = Math.floor(data.friend.presence.game.totalPlayTime / 60);
        const totalPlayTimeMinutes = data.friend.presence.game.totalPlayTime % 60;
        document.getElementById('totalPlayTime').textContent = `${totalPlayTimeHours} hours and ${totalPlayTimeMinutes} minutes`;

       // Display time playing now
        const sinceTimestamp = new Date(data.title.since).getTime();
        updatePlayingTime(sinceTimestamp);
    
        // Display additional Splatoon 3 info
        if (data.splatoon3) {
            const vsMode = data.splatoon3.vsMode;
            const vsSetting = data.splatoon3_vs_setting;

            // Display mode name
            const modeName = vsMode ? vsMode.name : 'N/A';
            document.getElementById('splatoonMode').textContent = modeName;

            // Display vs stages
            if (vsSetting && vsSetting.vsStages) {
                const stageNames = vsSetting.vsStages.map(stage => stage.name).join(' and ');
                document.getElementById('splatoonStages').textContent = stageNames;
                document.getElementById('splatoonInfo').style.display = 'block'; // Show Splatoon 3 info
            }
        }
} else {
    document.getElementById('gameInfo').style.display = 'none'; // Hide gameInfo div
}
    } catch (error) {
        console.error('Error fetching data:', error);
    }
}

function updatePlayingTime(sinceTimestamp) {
    const timePlayingNowElement = document.getElementById('timePlayingNow');

    // Update time every second
    setInterval(() => {
        const currentTime = new Date().getTime();
        const timeDifference = currentTime - sinceTimestamp;

        const hours = Math.floor(timeDifference / 3600000);
        const minutes = Math.floor((timeDifference % 3600000) / 60000);
        const seconds = Math.floor((timeDifference % 60000) / 1000);

        timePlayingNowElement.textContent = `${hours} hours, ${minutes} minutes, ${seconds} seconds`;
    }, 1000);
}

// Function to refresh the page every 3 minutes
function refreshPage() {
    location.reload();
}

// Fetch data when the page loads
fetchData();

// Refresh the page every 3 minutes (180,000 milliseconds)
setInterval(refreshPage, 180000);
    </script>

</body>
</html>
